<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical RAG System</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <header class="app-header">
        <div class="logo">Clinical RAG System - Multi-stage Orchestrator</div>
        <div class="system-specs">
            <span class="spec-item"><strong>Model:</strong> qwen3:4b</span>
            <span class="spec-item"><strong>Embedding:</strong> all-MiniLM-L6-v2</span>
            <span class="spec-item"><strong>Method:</strong> Hybrid (BM25 + FAISS)</span>
            <span class="spec-item"><strong>Rerank:</strong> Enabled</span>
        </div>
    </header>

    <div class="main-container">
        <!-- Left Panel: Inputs & Controls -->
        <aside class="left-panel">
            <div class="panel-section">
                <h3>Case Selection</h3>
                <select id="caseSelector">
                    <option value="">Select a case...</option>
                    <!-- Populated by JS -->
                </select>
            </div>

            <div class="panel-section">
                <h3>Orchestrator Prompts</h3>
                <textarea id="userQuestion" placeholder="Select a case to view orchestrator prompts..."
                    readonly></textarea>
            </div>

            <div class="panel-section control-group">
                <button id="btnGlobal" class="btn secondary">Run Global Retrieval</button>
                <button id="btnLocal" class="btn secondary">Run Local Retrieval</button>
                <button id="btnFull" class="btn primary">Run Full Pipeline</button>
                <button id="btnLoadReport" class="btn outline">Load Latest Report</button>
            </div>

            <div class="panel-section toggles">
                <label>
                    <input type="checkbox" id="toggleSoap" checked>
                    Global: Use SOAP Templates
                </label>
                <label>
                    <input type="checkbox" id="toggleHybrid" checked>
                    Local: Hybrid + Rerank
                </label>
                <label>
                    <input type="checkbox" id="toggleEvidenceIds" checked>
                    Show Evidence IDs
                </label>
                <label>
                    <input type="checkbox" id="toggleJson" checked>
                    JSON Strict Mode
                </label>
            </div>

            <div class="panel-section export-section">
                <button id="btnExport" class="btn outline small">Export report.json</button>
            </div>
        </aside>

        <!-- Center Panel: Chat UI -->
        <main class="center-panel">
            <div id="chatContainer" class="chat-container">
                <div class="chat-message system">
                    <div class="message-content">
                        Welcome to Clinical RAG Copilot. Select a case to begin.
                    </div>
                </div>
                <!-- Chat messages injected here -->
            </div>
            <div id="loadingIndicator" class="loading hidden">
                <div class="spinner"></div> Processing...
            </div>
        </main>

        <!-- Right Panel: Summary & Differential -->
        <aside class="right-panel">
            <div class="tabs">
                <button class="tab-btn active" data-tab="tab-summary">Summary</button>
                <button class="tab-btn" data-tab="tab-differential">Differential</button>
                <button class="tab-btn" data-tab="tab-metrics">Metrics</button>
            </div>

            <div class="tab-content" id="tab-summary">
                <div id="summaryContent" class="summary-content">
                    <p class="placeholder-text">Run the pipeline to see the summary.</p>
                </div>
            </div>

            <div class="tab-content hidden" id="tab-differential">
                <div id="differentialContent" class="differential-content">
                    <p class="placeholder-text">Run the pipeline to see the differential diagnosis.</p>
                </div>
            </div>

            <div class="tab-content hidden" id="tab-metrics">
                <div class="metrics-container">
                    <h4>BLEU & Validation Metrics</h4>
                    <textarea id="refSummary" placeholder="Paste reference summary here..."></textarea>
                    <button id="btnBleu" class="btn small">Compute BLEU</button>
                    <div id="bleuResult" class="bleu-result">--</div>
                </div>
            </div>
        </aside>
    </div>

    <script type="module" src="/static/js/main.js"></script>
</body>

</html>